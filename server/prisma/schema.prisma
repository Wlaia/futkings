generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  password      String
  name          String
  role          UserRole @default(PLAYER)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  playerProfile Player?
  managedTeam   Team?
}

model Championship {
  id                 String             @id @default(uuid())
  name               String
  type               ChampionshipType
  teamsCount         Int
  gameDuration       Int
  rules              Json?
  status             ChampionshipStatus @default(DRAFT)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  endDate            DateTime?
  groupsCount        Int?
  logoUrl            String?
  qualifiersPerGroup Int?
  startDate          DateTime?
  matches            Match[]
  teams              Team[]
}

model Team {
  id                    String        @id @default(uuid())
  name                  String
  logoUrl               String?
  championshipId        String?
  managerId             String?       @unique
  matchesPlayed         Int           @default(0)
  wins                  Int           @default(0)
  draws                 Int           @default(0)
  losses                Int           @default(0)
  goalsFor              Int           @default(0)
  goalsAgainst          Int           @default(0)
  coachName             String?
  directorName          String?
  isPublicLinkActive    Boolean       @default(false)
  publicCanAddPlayer    Boolean       @default(false)
  publicCanEditPlayer   Boolean       @default(false)
  publicCanImportPlayer Boolean       @default(false)
  publicCanPrintPlayer  Boolean       @default(false)
  awayMatches           Match[]       @relation("AwayTeam")
  homeMatches           Match[]       @relation("HomeTeam")
  players               Player[]
  championship          Championship? @relation(fields: [championshipId], references: [id])
  manager               User?         @relation(fields: [managerId], references: [id])
}

model Player {
  id            String            @id @default(uuid())
  name          String
  number        Int
  position      PlayerPosition
  avatarUrl     String?
  teamId        String
  userId        String?           @unique
  goals         Int               @default(0)
  assists       Int               @default(0)
  yellowCards   Int               @default(0)
  redCards      Int               @default(0)
  saves         Int               @default(0)
  goalsConceded Int               @default(0)
  fouls         Int               @default(0)
  birthDate     DateTime?
  isStarter     Boolean           @default(false)
  positionX     Float?
  positionY     Float?
  team          Team              @relation(fields: [teamId], references: [id])
  user          User?             @relation(fields: [userId], references: [id])
  matchStats    PlayerMatchStat[]
}

model Match {
  id             String            @id @default(uuid())
  championshipId String
  homeTeamId     String?
  awayTeamId     String?
  homeScore      Int?
  awayScore      Int?
  round          String
  startTime      DateTime?
  status         MatchStatus       @default(SCHEDULED)
  homeShootoutScore Int?
  awayShootoutScore Int?
  awayTeam       Team?             @relation("AwayTeam", fields: [awayTeamId], references: [id])
  championship   Championship      @relation(fields: [championshipId], references: [id])
  homeTeam       Team?             @relation("HomeTeam", fields: [homeTeamId], references: [id])
  playerStats    PlayerMatchStat[]
}

model PlayerMatchStat {
  id            String @id @default(uuid())
  matchId       String
  playerId      String
  goals         Int    @default(0)
  assists       Int    @default(0)
  yellowCards   Int    @default(0)
  redCards      Int    @default(0)
  saves         Int    @default(0)
  goalsConceded Int    @default(0)
  fouls         Int    @default(0)
  match         Match  @relation(fields: [matchId], references: [id])
  player        Player @relation(fields: [playerId], references: [id])
}

enum UserRole {
  ADMIN
  MANAGER
  PLAYER
}

enum ChampionshipType {
  GROUPS_KNOCKOUT
  KNOCKOUT_ONLY
  LEAGUE_WITH_FINAL
}

enum ChampionshipStatus {
  DRAFT
  ACTIVE
  COMPLETED
}

enum PlayerPosition {
  GOALKEEPER
  FIELD
}

enum MatchStatus {
  SCHEDULED
  LIVE
  COMPLETED
}
